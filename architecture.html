<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>General architecture - CRBl_ Studio Games - Project Description and Documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This book covers the ins and outs of the CRBl_ Studio Games project, describing how it should be and how it works">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="other/mdbook-admonish.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="description.html"><strong aria-hidden="true">1.</strong> Description</a></li><li class="chapter-item expanded affix "><li class="part-title">Project components</li><li class="chapter-item expanded "><a href="architecture.html" class="active"><strong aria-hidden="true">2.</strong> General architecture</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Authentication service</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Description</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> API</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> API service</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Description</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> API</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Game server</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.</strong> Description</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.</strong> API</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.3.</strong> Mini-games API</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Mini-game servers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Description</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Example</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CRBl_ Studio Games - Project Description and Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="general-architecture"><a class="header" href="#general-architecture">General architecture</a></h1>
<p>Here is a diagram explaining the general architecture of the project. The blue
part represents communications with authenticated users. The green part
represents the area where a game is played. For more details, continue reading
the paragraphs below.</p>
<pre class="mermaid">sequenceDiagram
    participant U as User
    participant GS as Game Server
    participant MGS as Mini Game Server
    participant Api as API
    participant Auth as Authentication Service
    U-&gt;&gt;Auth: credentials
    Auth-&gt;&gt;U: auth certification
    MGS-&gt;&gt;GS: registers with api key
    GS-&gt;&gt; Auth: checks api key
    rect rgb(9, 66, 163)
        note left of Auth: authenticated user
        U-&gt;&gt;Api: create room request
        Api-&gt;&gt;U: room id
        U-&gt;&gt;GS: joins
        U-&gt;&gt;GS: configure room
        GS-&gt;&gt;Auth: verify user
        rect rgb(14, 107, 7)
            note left of MGS: play game
            U-&gt;&gt;GS: game data
            GS-&gt;&gt;MGS: game data
            note over GS,MGS: communication through secure api
            MGS-&gt;&gt;GS: game data
            GS-&gt;&gt;U: game data
        end
        GS-&gt;&gt;Api: results
        U-&gt;&gt;Api: check results, stats, etc.
    end
</pre>
<h2 id="modules-in-depth-description"><a class="header" href="#modules-in-depth-description">Modules in-depth description</a></h2>
<h3 id="authentication-service"><a class="header" href="#authentication-service">Authentication service</a></h3>
<p>The authentication service does exactly what its name tells you, nothing more.
It is a key point to the project's security. It allows the user to
authenticate, and then prove his identity to the API service and the game
server.</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<a class="admonition-anchor-link" href="#admonition-info">
<p>Info</p>
</a>
</div>
<div>
<p>OAuth 2.0 implementation would allow other external services like mini-games
servers to access user information in order to extend their functionality.</p>
</div>
</div>
<h3 id="api-service"><a class="header" href="#api-service">API service</a></h3>
<p>The API service manages general user data, like friends, game history, high
scores, added mini-games, etc. and it is also responsible for room creation. It
relies on the authentication service to identify the user.</p>
<h3 id="game-server"><a class="header" href="#game-server">Game server</a></h3>
<p>The game server is a real time socket server which communicates with the
different clients during the game. It is responsible for handling the main game
flow, and making contact between the mini-game server and the client. It is a
trusted, first party component. It also relies on the authentication service to
identify users. It interacts with the API service to create rooms, save scores,
etc.</p>
<h3 id="mini-games-servers"><a class="header" href="#mini-games-servers">Mini-games servers</a></h3>
<p>A mini-game server is a real time socket server that implements a mini-game. It
can either be a first party server, or a third party, self-hosted server. To
ensure security, communication between this and the client is done through the
game server, using a secure and well-defined API.</p>
<h3 id="client"><a class="header" href="#client">Client</a></h3>
<p>The client used by the user to play games is a website. The website uses the
authentication service to get access to a token which will identify itself to
other services. It mainly interacts with the API service for viewing and
updating personal data, or creating a room. It communicates with the game
server during the game to send user actions and receive game information.</p>
<h2 id="reasoning"><a class="header" href="#reasoning">Reasoning</a></h2>
<p>First of all, we need to establish the goals we are trying to achieve :</p>
<ul>
<li>Ease of implementation</li>
<li>Modularity (for plug in mini games)</li>
<li>Security (mini games should not be able to be a point of attack, no matter what)</li>
<li>Functionality (mini games should not be limited in any way, or at least to be the least limited possible)</li>
</ul>
<p>Ease of implementation is obvious, do not make it hard if it does not have to
be. Modularity is a must as well : mini-games should be able to be added,
removed, updated without need to touch the project's code. They should be able
to run on other servers, even community servers (self hosted). This means
security has to be very well thought out, since some people might try to create
malicious mini-game servers. The implementation should also not limit the
functionality of mini-games.</p>
<p>This implementation allows for a very great combination of all of the above.
Modularity is respected. Mini-game servers are run on any machine,
authenticated through the authentication service, and plugged in to the game
server. The IP's of the mini-game servers should be stored in a database, and
the authentication service should provide them with API keys, which they will
use to authenticate themselves to other services. This also allows the
mini-game servers to be implemented in any language, leaving the door open to
all developers.</p>
<p>Security is implemented through the game server &lt;-&gt; mini-game server API. The
latter is not yet defined, but it's structure will only allow it to do basic,
game related actions, and not access user data or any other kind of sensitive
endpoint/data.</p>
<p>Functionality is defined through the API as well. That's why it has to be as
open and extensible as possible, while remaining secure.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="description.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="description.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="other/mermaid.min.js"></script>
        <script type="text/javascript" src="other/mermaid-init.js"></script>
    </body>
</html>
